# NVDA 자율 진화 - 목표(연 15%+, MDD 8% 이하, Sharpe 1.5+) 달성 시 best_params 반영 후 푸시
name: Quant Evolve (NVDA)
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

env:
  SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

jobs:
  evolve:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run NVDA evolution (7:3 split, OOS, stability)
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
        run: python scripts/evolve_nvda.py

      - name: Commit and push if best_params, history, or optimization_log changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data/best_params.json data/strategy_history.json data/optimization_log.csv
          if ! git diff --staged --quiet; then
            git commit -m "chore: NVDA evolve - best_params / strategy_history / optimization_log [auto]"
            git push origin main
          fi
